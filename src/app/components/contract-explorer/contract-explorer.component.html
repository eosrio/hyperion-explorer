<mat-dialog-content>
  @if (code()) {

    <div class="my-5">Please select a table:</div>

    <div class="grid dialog-grid-parent">
      @for (tableName of abiTableNames(); track tableName) {
        <button (click)="selectTable(tableName)" mat-raised-button class="grid-item-btn"
                [ngClass]="{'selected': tableName === table()}">{{ tableName }}
        </button>
      }
    </div>
  }

  @defer (on immediate) {
    @if (table()) {
      <div class="bg-slate-800 text-xl text-center text-white py-2 mt-6">
        <span class="text-stone-200">Table: </span>
        <span class="text-green-400">{{ table() }}</span>
      </div>

      <p>Please select a scope:</p>
      <div class="flex flex-row flex-wrap gap-2 m-2">
        @for (sName of scopeList(); track sName) {
          <button (click)="selectScope(sName)" mat-flat-button
                  [color]="sName === scope() ? 'accent' : 'primary'">{{ sName }}
          </button>
        }
      </div>

      @if (nextScope()) {
        <p>Next Scope: {{ nextScope() }}</p>

        <div class="flex flex-row w-full justify-start p-4 items-center">
          <label for="customScope">Custom Scope:</label>
          <input (keyup.enter)="selectScope(customScope.value)" [value]="scope()"
                 class="mx-10" #customScope id="customScope" type="text"/>
          <button (click)="selectScope(customScope.value)" mat-flat-button color="primary">Select</button>
        </div>
      }

      @if (scope()) {

        <div class="bg-slate-900 text-xl text-center text-white py-2">
          <span class="text-stone-200">Scope: </span>
          <span class="text-green-400">{{ scope() }}</span>
        </div>

        @defer (when displayedColumns().length > 0) {
          <table mat-table [dataSource]="tableData()" class="mat-elevation-z8"
                 matSort (matSortChange)="announceSortChange($event)">
            @for (field of fields(); track field.name) {
              <ng-container [matColumnDef]="field.name">

                <th mat-header-cell
                    *matHeaderCellDef mat-sort-header
                    [matTooltip]="'Type: ' + field.type"
                    [sortActionDescription]="'Sort by ' + field.name">{{ field.name }}
                </th>

                <td mat-cell *matCellDef="let element">{{ element[field.name] }}</td>
              </ng-container>
            }
            <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns();"></tr>
          </table>
        }
      }

    }
  }
</mat-dialog-content>
