@if (!accountService.loaded()) {
  <mat-progress-spinner
    [diameter]="45"
    mode="indeterminate"
  ></mat-progress-spinner>
}

<div class="hr-container">
  @if (tx().actions && tx().actions.length === 0) {
    <div
      style="height: calc(100vh - 209px)"
      class="flex flex-column justify-start items-center"
    >
      <mat-card style="width: 100%">
        <h1 class="faded">
          <fa-icon [icon]="icons.solid.faSadTear" style="margin-right: 5px"></fa-icon>
          Transaction not found
        </h1>
        <div>
          We couldn't find the transaction
          <strong class="break-word">{{ txID() }}</strong>
        </div>
      </mat-card>
    </div>
  }

  @if (tx().actions && tx().actions.length > 0 && accountService.loaded()) {
    <div class="flex flex-column justify-start items-center gap-[15px]">
      <mat-card class="flex-100 w-full min-w-full h-full min-h-full">
        <div style="border-bottom: 1px solid #e4e4e4; margin-bottom: 12px">
          <div class="flex flex-row justify-start items-start">
            <h2
              style="
                margin-bottom: -15px;
                color: #9c9c9c;
                margin-top: 0;
                margin-right: 10px;
              "
            >
              <fa-layers [fixedWidth]="true" style="margin-right: 2px">
                <fa-icon [icon]="icons.solid.faCircle" transform="grow-1"></fa-icon>
                <fa-icon
                  [icon]="icons.solid.faExchange"
                  [inverse]="true"
                  transform="shrink-4"
                ></fa-icon>
              </fa-layers>
              Transaction
            </h2>
            <mat-chip-listbox class="mat-mdc-chip-set-stacked">
              @if (accountService.libNum > tx().actions[0]["block_num"]) {
                <mat-chip-option selected>
                  <fa-icon [icon]="icons.solid.faLock" style="margin-right: 5px"></fa-icon>
                  Irreversible
                </mat-chip-option>
              }
              @if (accountService.libNum < tx().actions[0]["block_num"]) {
                <mat-chip-option color="accent" selected>
                  <fa-icon
                    [icon]="icons.solid.faHourglass"
                    style="margin-right: 5px"
                  ></fa-icon>
                  Pending ({{ countdownTimer }}s)
                </mat-chip-option>
              }
            </mat-chip-listbox>
          </div>
          <h4 style="margin: 10px 0 12px 0" class="break-word">
            {{ tx().trx_id }}
          </h4>
        </div>
        <div class="flex flex-column justify-start items-stretch gap-[15px]">
          <div>
            Block num:
            <a
              [routerLink]="['/block', tx().actions[0].block_num]"
              class="link-blue"
            >{{ tx().actions[0].block_num }}</a
            >
          </div>
          <div>Block time: {{ formatDate(tx().actions[0]["@timestamp"]) }}</div>
          <div class="flex flex-row justify-start content-center gap-[50px]">
            <div>
              <div>
                <span class="title">CPU</span>
                <span class="faded used">usage</span>
              </div>
              <div>{{ tx().actions[0]["cpu_usage_us"] }} Âµs</div>
            </div>
            <div>
              <div>
                <span class="title">NET</span>
                <span class="faded used">usage</span>
              </div>
              <div>{{ tx().actions[0]["net_usage_words"] }} bytes</div>
            </div>
          </div>
        </div>
      </mat-card>
      <mat-card class="flex-100 w-full min-w-full h-full min-h-full">
        <h3 style="margin-top: 0">
          <fa-layers [fixedWidth]="true" style="margin-right: 5px">
            <fa-icon [icon]="icons.solid.faCircle" transform="grow-3"></fa-icon>
            <fa-icon
              [icon]="icons.solid.faHistory"
              [inverse]="true"
              transform="shrink-5"
            ></fa-icon>
          </fa-layers>
          {{ tx().actions.length }} Action
          @if (tx().actions.length > 1) {
            <span>s</span>
          }
        </h3>
        <table mat-table [dataSource]="tx().actions" class="actions-table">
          <!-- Contract Column -->
          <ng-container matColumnDef="contract">
            <th mat-header-cell *matHeaderCellDef>Contract</th>
            <td mat-cell *matCellDef="let action" data-label="Contract">
              <span
                [routerLink]="['/account', action.act.account]"
                class="div-link"
              >{{ action.act.account }}</span
              >
            </td>
          </ng-container>
          <!-- Action Column -->
          <ng-container matColumnDef="action">
            <th
              mat-header-cell
              *matHeaderCellDef
            >
              Action
            </th>
            <td
              mat-cell
              *matCellDef="let action"
              data-label="Action"
            >
              <span class="accent w-500">{{ action.act.name }}</span>
            </td>
          </ng-container>
          <!-- Data Column -->
          <ng-container matColumnDef="data">
            <th mat-header-cell *matHeaderCellDef>Data</th>
            <td
              mat-cell
              *matCellDef="let action"
              data-label="Data"
            >
              @for (item of action["act"]["data"] | keyvalue; track item) {
                <div
                  [ngClass]="{
                    'data-item': objectKeyCount(action['act']['data']) > 1
                  }"
                >
                  <span class="w-500">{{ item.key }}</span
                  >: <span class="break-word">{{ item.value }}</span>
                </div>
              }
            </td>
          </ng-container>
          <!-- Authorization Column -->
          <ng-container matColumnDef="auth">
            <th mat-header-cell *matHeaderCellDef>Authorization</th>
            <td
              mat-cell
              *matCellDef="let action"
              data-label="Authorization"
            >
              @for (auth of action["act"]["authorization"][0] | keyvalue;
                track auth) {
                <div class="data-item">
                  <span class="w-500">{{ auth.key }}</span
                  >: <span>{{ auth.value }}</span>
                </div>
              }
            </td>
          </ng-container
          >

          <tr
            mat-header-row
            *matHeaderRowDef="columnsToDisplay; sticky: true"
          ></tr>

          <tr
            mat-row
            *matRowDef="let myRowData; columns: columnsToDisplay"
          ></tr>
        </table>
      </mat-card>
    </div>
  }
</div>
