<div class="hr-container justify-start flex flex-col items-center w-full">

  <!-- Card Container -->
  <div class="grid grid-cols-1 md:grid-cols-3 auto-cols-max gap-5 text-black appear w-full">
    <div
      class="tabs-card relative w-full min-w-full h-full min-h-full md:col-span-3"
      [class.is-expanded]="isExpanded"
      [class.is-collapsed]="!isExpanded"
    >
      <!-- Collapsed Header: Clickable area to expand -->
      <div
        *ngIf="!isExpanded"
        class="collapsed-header flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-gray-100/10 dark:hover:bg-white/5 transition-colors duration-200 ease-in-out rounded-[var(--card-border-radius)]"
        (click)="toggleExpansion()"
        role="button"
        tabindex="0"
        (keydown.enter)="toggleExpansion()"
        (keydown.space)="toggleExpansion()"
        aria-expanded="false"
        aria-controls="expanded-content-area"
      >
        <!-- Simplified Icon Button -->
        <button mat-icon-button type="button"
                class="flex-shrink-0 text-[var(--primary)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:ring-offset-2 focus:ring-offset-[var(--card-bg)]"
                aria-hidden="true"
                tabindex="-1"> <!-- This comment position is OK -->
          <mat-icon class="text-xl leading-none">expand_more</mat-icon> <!-- This comment position is OK -->
        </button>
        <span class="font-medium text-[var(--main-text)] flex-grow text-sm">Show Chain Details</span>
      </div>

      <!-- Expanded Content Wrapper (Handles animation) -->
      <div id="expanded-content-area" class="expanded-content-wrapper" [@expandCollapse]="isExpanded ? 'expanded' : 'collapsed'">
        <!-- Actual Tab Group (Only rendered when expanded) -->
        <mat-tab-group *ngIf="isExpanded" fitInkBarToContent class="h-full login-source-tabs expanded-content" (click)="$event.stopPropagation()">
          <!-- Tab Header Area (Prevent collapsing when clicking here) -->
          <ng-template matTabHeaderFocus></ng-template>

          <mat-tab #statsTab>
            <ng-template mat-tab-label>
              <div class="flex flex-row items-center gap-3 w-full">
                <div>Chain Stats</div>
              </div>
            </ng-template>
            <ng-template matTabContent>
              <div (click)="$event.stopPropagation()">
                <app-stats></app-stats>
              </div>
            </ng-template>
          </mat-tab>

          <mat-tab #priceTab>
            <ng-template mat-tab-label>
              <div class="flex flex-row items-center gap-3 w-full">
                <div>Price History</div>
              </div>
            </ng-template>
            <ng-template matTabContent>
              <div (click)="$event.stopPropagation()">
                <app-price-history></app-price-history>
              </div>
            </ng-template>
          </mat-tab>

          <mat-tab #producersTab>
            <ng-template mat-tab-label>
              <div class="flex flex-row items-center gap-3 w-full">
                <div>Producers</div>
              </div>
            </ng-template>
            <ng-template matTabContent>
              <div (click)="$event.stopPropagation()">
                <app-producers></app-producers>
              </div>
            </ng-template>
          </mat-tab>
        </mat-tab-group>
      </div> <!-- End .expanded-content-wrapper -->

      <!-- Separate Expand/Collapse Icon Button (Only visible & functional when expanded) -->
      <button
        *ngIf="isExpanded"
        mat-icon-button type="button"
        class="absolute bottom-4 left-4 z-20 w-8 h-8 leading-none bg-[var(--primary)] text-[var(--primary-content)] shadow-md hover:bg-[var(--primary-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:ring-offset-2 focus:ring-offset-[var(--card-bg)] transition-all duration-200 ease-in-out transform rotate-180"
        (click)="toggleExpansion($event)"
        aria-label="Collapse chain details"
        [attr.aria-expanded]="isExpanded"
        aria-controls="expanded-content-area"
      >
        <mat-icon class="text-xl leading-none">expand_more</mat-icon>
      </button>

    </div> <!-- End .tabs-card -->
  </div> <!-- End .grid -->
</div> <!-- End .hr-container -->
